<!doctype html>
<html lang="en">
<head>
	<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#0ea5a0">

  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>EasyBill â€” Invoice + UPI Link</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
  <style>
	  @media print {
  body * { visibility: hidden; }
  #previewBox, #previewBox * { visibility: visible; }
  #previewBox { position: absolute; top: 0; left: 0; width: 100%; }
}

    body{font-family:sans-serif;margin:0;padding:20px;background:#f6f8fb;color:#333}
    h1{color:#0ea5a0;text-align:center;margin-bottom:15px}
    form{background:#fff;padding:15px;border-radius:10px;box-shadow:0 2px 6px rgba(0,0,0,.1);margin-bottom:20px}
    label{display:block;margin:10px 0 4px}
    input,select,textarea{width:100%;padding:8px;border:1px solid #ccc;border-radius:6px}
    button{background:#0ea5a0;color:#fff;border:none;padding:10px 16px;margin-top:10px;border-radius:6px;cursor:pointer}
    button.ghost{background:#eee;color:#333}
    .preview{background:#fff;padding:15px;border-radius:10px;box-shadow:0 2px 6px rgba(0,0,0,.1);margin-top:20px}
    .preview h3{margin-top:0}
    .row{display:flex;justify-content:space-between;margin:4px 0}
    .qr{margin-top:12px;text-align:center}
    .history-item{display:flex;justify-content:space-between;align-items:center;padding:6px 0;border-bottom:1px solid #ddd}
    .msg{color:red;text-align:center;margin:10px 0}
    .template-simple{font-family:sans-serif;}
    .template-modern{font-family:Arial,Helvetica,sans-serif;border-left:4px solid #0ea5a0;padding-left:10px;}
    .template-classic{font-family:"Times New Roman",serif;font-style:italic;background:#fafafa;border:1px dashed #999;padding:10px;}
  </style>
</head>
<body>

<h1>EasyBill â€” Invoice Generator</h1>

<form id="invoiceForm">
  <label>Shop Name</label>
  <input id="shopName" placeholder="My Shop"/>
  
  <label>Date</label>
  <input id="date" type="date"/>
  
  <label>Customer Name</label>
  <input id="custName" placeholder="Customer"/>
  
  <label>Note</label>
  <textarea id="note" placeholder="Payment for order..."></textarea>
  
  <label>Amount (INR)</label>
  <input id="amount" type="number" step="0.01"/>
  
  <label>UPI ID (VPA)</label>
  <input id="vpa" placeholder="example@upi"/>
  
  <label>Payee Name</label>
  <input id="payeeName" placeholder="Receiver name"/>
  
  <label>Payment Type</label>
  <select id="paymentType">
    <option>UPI</option>
    <option>Cash</option>
    <option>Card</option>
    <option>Wallet</option>
  </select>
  
  <label>Invoice Template</label>
  <select id="templateType">
    <option value="simple">Simple</option>
    <option value="modern">Modern</option>
    <option value="classic">Classic</option>
  </select>
  
  <button type="submit">Generate Invoice</button>
</form>

<div class="msg" id="msg"></div>

<div id="previewBox" class="preview template-simple">
  <h3 id="previewShop">My Shop</h3>
  <div class="row"><strong>Date:</strong> <span id="previewDate">â€”</span></div>
  <div class="row"><strong>Customer:</strong> <span id="previewCust">â€”</span></div>
  <div class="row"><strong>Note:</strong> <span id="previewNote">â€”</span></div>
  <div class="row"><strong>Amount:</strong> <span id="previewAmount">â€”</span></div>
  <div class="row"><strong>Payment Type:</strong> <span id="previewPayType">â€”</span></div>
  <div class="row"><strong>UPI Link:</strong> <a id="upiLink" href="#" target="_blank">â€”</a></div>
  <div class="qr" id="qrImg"></div>
  <button id="saveBtn">Save Invoice</button>
  <button id="printBtn" class="ghost">Print/PDF</button>
  <button id="shareBtn" class="ghost">Share WhatsApp</button>

</div>

<h3>Saved Invoices</h3>
<div id="history"></div>
<button id="clearHistory">Clear History</button>

<script>
  const form = document.getElementById('invoiceForm');
  const dateEl = document.getElementById('date');
  const previewShop = document.getElementById('previewShop');
  const previewDate = document.getElementById('previewDate');
  const previewCust = document.getElementById('previewCust');
  const previewNote = document.getElementById('previewNote');
  const previewAmount = document.getElementById('previewAmount');
  const previewPayType = document.getElementById('previewPayType');
  const upiLinkA = document.getElementById('upiLink');
  const qrImg = document.getElementById('qrImg');
  const msg = document.getElementById('msg');
  const historyEl = document.getElementById('history');
  const previewBox = document.getElementById('previewBox');

  dateEl.value = new Date().toISOString().slice(0,10);

  function formatINR(amount){
    return 'â‚¹' + Number(amount).toLocaleString('en-IN', {minimumFractionDigits:2, maximumFractionDigits:2});
  }
  function buildUpiLink(data){
    return `upi://pay?pa=${encodeURIComponent(data.pa)}&pn=${encodeURIComponent(data.pn)}&am=${encodeURIComponent(data.am)}&tn=${encodeURIComponent(data.tn)}`;
  }
  function updateQRCode(text){
    qrImg.innerHTML = "";
    new QRCode(qrImg,{text,width:140,height:140});
  }
  function updatePreview(data){
    const link = buildUpiLink({
      pa:data.vpa||"test@upi",
      pn:data.payeeName||data.shopName||"Merchant",
      am:(Number(data.amount)||0).toFixed(2),
      tn:data.note||"Invoice"
    });
    previewShop.textContent=data.shopName||"My Shop";
    previewDate.textContent=data.date;
    previewCust.textContent=data.custName||"â€”";
    previewNote.textContent=data.note||"â€”";
    previewAmount.textContent=formatINR(data.amount);
    previewPayType.textContent=data.paymentType;
    upiLinkA.href=link; upiLinkA.textContent=link;
    updateQRCode(link);
    previewBox.className="preview template-"+data.template;
  }

  form.addEventListener('submit', e=>{
    e.preventDefault();
    const data={
      shopName:document.getElementById('shopName').value.trim(),
      date:dateEl.value,
      custName:document.getElementById('custName').value.trim(),
      note:document.getElementById('note').value.trim(),
      amount:Number(document.getElementById('amount').value||0).toFixed(2),
      vpa:document.getElementById('vpa').value.trim(),
      payeeName:document.getElementById('payeeName').value.trim(),
      paymentType:document.getElementById('paymentType').value,
      template:document.getElementById('templateType').value
    };
    if(!data.custName||!data.amount||!data.vpa){msg.textContent="Fill Customer, Amount & UPI";setTimeout(()=>msg.textContent="",2500);return;}
    updatePreview(data);
    msg.textContent="Invoice generated.";
    setTimeout(()=>msg.textContent="",2500);
  });

  function getHistory(){return JSON.parse(localStorage.getItem('easybill_history')||'[]');}
  function setHistory(h){localStorage.setItem('easybill_history',JSON.stringify(h));}
  function renderHistory(){
    historyEl.innerHTML="";
    getHistory().forEach((it,i)=>{
      const div=document.createElement("div");
      div.className="history-item";
      div.innerHTML=`<span>${it.date} - ${it.custName} (${it.paymentType}) - ${formatINR(it.amount)}</span>
        <button class="ghost" data-i="${i}">View</button>`;
      div.querySelector("button").onclick=()=>updatePreview(it);
      historyEl.appendChild(div);
    });
  }
  document.getElementById('saveBtn').onclick=()=>{
    const data={
      shopName:document.getElementById('shopName').value.trim(),
      date:dateEl.value,
      custName:document.getElementById('custName').value.trim(),
      note:document.getElementById('note').value.trim(),
      amount:Number(document.getElementById('amount').value||0).toFixed(2),
      vpa:document.getElementById('vpa').value.trim(),
      payeeName:document.getElementById('payeeName').value.trim(),
      paymentType:document.getElementById('paymentType').value,
      template:document.getElementById('templateType').value
    };
    const h=getHistory();h.unshift(data);setHistory(h);renderHistory();
    msg.textContent="Invoice saved.";setTimeout(()=>msg.textContent="",2000);
  };
  document.getElementById('clearHistory').onclick=()=>{localStorage.removeItem('easybill_history');renderHistory();};

  document.getElementById('printBtn').onclick=()=>window.print();

  renderHistory();
	document.getElementById('shareBtn').onclick = () => {
  const shop = document.getElementById('shopName').value.trim() || "My Shop";
  const cust = document.getElementById('custName').value.trim() || "Customer";
  const amt  = document.getElementById('amount').value || "0.00";
  const pay  = document.getElementById('paymentType').value;
  const link = upiLinkA.href;

  const message = `ðŸ§¾ *Invoice from ${shop}* \n\nðŸ‘¤ Customer: ${cust}\nðŸ’° Amount: â‚¹${amt}\nðŸ’³ Payment: ${pay}\n\nðŸ”— Pay using UPI: ${link}`;
  const url = "https://wa.me/?text=" + encodeURIComponent(message);
  window.open(url, "_blank");
};

</script>
<script>
  if ("serviceWorker" in navigator) {
    navigator.serviceWorker.register("service-worker.js")
      .then(() => console.log("Service Worker Registered"));
  }
</script>

</body>
</html>
